{"version":3,"sources":["webpack:///src/app/authentification/authentification.module.ts","webpack:///src/app/authentification/authentification.page.ts","webpack:///src/app/authentification/authentification.page.scss","webpack:///src/app/authentification/authentification-routing.module.ts","webpack:///src/app/authentification/authentification.page.html","webpack:///node_modules/@auth0/angular-jwt/__ivy_ngcc__/fesm2015/auth0-angular-jwt.js"],"names":["AuthentificationPageModule","imports","declarations","AuthentificationPage","formBuilder","service","toastController","route","activatedRoute","isValid","helper","isConnected","originPage","snapshot","paramMap","get","sessionStorage","getItem","setTimeout","navigate","userForm","group","email","password","valueChanges","subscribe","values","value","event","key","authentification","body","document","querySelector","elements","querySelectorAll","forEach","element","disabled","style","cursor","res","rawToken","headers","setItem","decodedToken","decodeToken","findImg","user","id","img","storedUser","name","firstname","address","postalCode","town","phone","sex","wallet","isLunchLady","JSON","stringify","error","status","presentToast","selector","template","routes","path","component","AuthentificationPageRoutingModule","forChild","exports","JWT_OPTIONS","JwtHelperService","config","tokenGetter","str","output","replace","length","Error","b64DecodeUnicode","chars","String","bc","bs","buffer","idx","charAt","fromCharCode","indexOf","decodeURIComponent","Array","prototype","map","call","b64decode","c","charCodeAt","toString","slice","join","token","parts","split","decoded","urlBase64Decode","parse","hasOwnProperty","date","Date","setUTCSeconds","exp","offsetSeconds","getTokenExpirationDate","valueOf","authScheme","request","ɵfac","JwtHelperService_Factory","t","ɵprov","factory","ctorParameters","type","undefined","decorators","args","JwtInterceptor","jwtHelper","standardPorts","headerName","allowedDomains","disallowedRoutes","throwNoTokenError","skipWhenExpired","requestUrl","URL","url","location","origin","host","hostName","hostname","port","includes","findIndex","domain","RegExp","test","requestedUrl","parsedRoute","pathname","next","getAuthScheme","tokenIsExpired","isTokenExpired","clone","setHeaders","handle","isAllowedDomain","isDisallowedRoute","Promise","pipe","asyncToken","handleInterception","JwtInterceptor_Factory","Document","JwtModule","parentModule","options","ngModule","providers","provide","useClass","multi","jwtOptionsProvider","useValue","ɵmod","ɵinj","JwtModule_Factory"],"mappings":"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","file":"authentification-authentification-module-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IonicModule } from '@ionic/angular';\nimport { FormsModule ,ReactiveFormsModule } from '@angular/forms';\nimport { AuthentificationPage } from './authentification.page';\nimport { AuthentificationPageRoutingModule } from './authentification-routing.module';\nimport { HeaderComponent } from '../header/header.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    IonicModule,\n    AuthentificationPageRoutingModule\n  ],\n  declarations: [AuthentificationPage,HeaderComponent]\n})\nexport class AuthentificationPageModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ToastController } from '@ionic/angular';\nimport { CantiniereAPIService } from '../cantiniere-api.service';\nimport { ToastUtils } from '../utils/ToastUtils';\nimport { JwtHelperService } from \"@auth0/angular-jwt\";\n\n@Component({\n  selector: 'app-authentification',\n  templateUrl: './authentification.page.html',\n  styleUrls: ['./authentification.page.scss'],\n})\nexport class AuthentificationPage implements OnInit {\n  isValid: boolean = false;\n  userForm: FormGroup;\n  // En plus du token brut, ces deux variables vont permettre d'en extraire l'utilisateur authentifié\n  rawToken: string;\n  helper: JwtHelperService = new JwtHelperService()\n  decodedToken;\n  // Cette variable, par défaut à false, passe à vrai si un token est présent en sessionStorage\n  // Cela permet à la page de ne pas être affiché si l'utilisateur est déjà connecté\n  isConnected:boolean = false;\n  originPage: string\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private service: CantiniereAPIService,\n    private toastController: ToastController,\n    private route: Router,\n    private activatedRoute: ActivatedRoute\n  ) { }\n\n  ngOnInit() {\n\n    // recuperation du nom de la page précédente\n    this.originPage = this.activatedRoute.snapshot.paramMap.get(\"originPage\")\n\n    // Si un utilisateur est connecté, le template sera différent et on redirigera automatiquement vers l'accueil\n    if (sessionStorage.getItem(\"JWT\")){\n      this.isConnected = true;\n      setTimeout(()=>{\n        this.route.navigate(['home']);\n      },3000);\n    }\n\n    // On crée ce FormGroup pour réunir les données entrées par l'utilisateur\n    this.userForm = this.formBuilder.group({\n      email: \"\",\n      password: \"\"\n    });\n\n    // Cet observable n'activera le bouton de validation que si les champs sont remplis \n    this.userForm.valueChanges.subscribe(values => {\n      let value = this.userForm.value;\n      if ((value.email !== \"\") && (value.password !== \"\")) {\n        this.isValid = true;\n      }\n      else {\n        this.isValid = false;\n      }\n    });\n  }\n\n  authentificationKey(event){\n    // Cette fonction lance la fonction d'identification quand l'utilisateur a le focus sur le champ de mot de passe et appuie sur Entrée\n    if (event.key == \"Enter\"){\n      if (this.isValid){\n        this.authentification();\n      }\n    }\n  }\n\n  authentification() {\n    // On désactive toutes les actions le temps que la réponse du serveur arrive (et on montre avec le curseur de la souris que le traitement est en cours)\n    let body = document.querySelector('body');\n    let elements: any = document.querySelectorAll('ion-input , ion-button');\n    elements.forEach(element => {\n      element.disabled = true;\n    });\n    body.style.cursor = \"wait\";\n    // On fait la requête d'authentification\n    this.service.authentification(this.userForm.value.email, this.userForm.value.password).subscribe(res => {\n      // Une fois reçue, on stocke le JWT ainsi que sa version décodée, et on fait une seconde requête pour chercher l'avatar de l'utilisateur\n      this.rawToken = res.headers.get(\"Authorization\");\n      sessionStorage.setItem(\"JWT\", this.rawToken);\n      this.decodedToken = this.helper.decodeToken(this.rawToken);\n      this.service.findImg(this.decodedToken.user.id, this.rawToken).subscribe((img: any) => {\n        // Maintenant on va créer un objet contenant les données de l'utilisateur, le stringifier et le stocker en sessionStorage\n        let storedUser = {\n          \"id\": this.decodedToken.user.id,\n          \"name\": this.decodedToken.user.name,\n          \"firstname\": this.decodedToken.user.firstname,\n          \"email\": this.decodedToken.user.email,\n          \"address\": this.decodedToken.user.address,\n          \"postalCode\": this.decodedToken.user.postalCode,\n          \"town\": this.decodedToken.user.town,\n          \"phone\": this.decodedToken.user.phone,\n          \"sex\": this.decodedToken.user.sex,\n          \"wallet\": this.decodedToken.user.wallet,\n          \"image\": img,\n          \"isLunchLady\": this.decodedToken.user.isLunchLady\n        };\n\n        sessionStorage.setItem(\"User\", JSON.stringify(storedUser));\n        // On laisse de nouveau l'utilisateur agir une fois la réponse reçue\n        body.style.cursor = \"initial\"\n        elements.forEach(element => {\n          element.disabled = false;\n        });\n        \n        if(this.originPage == \"panier\"){\n          this.route.navigate([\"panier\"]);\n        } else this.route.navigate([\"home\"]);\n        \n      });\n    },\n    (error:any) => {\n      // Si les identifiants sont incorrects, on l'affiche\n      if (error.status === 401)\n        ToastUtils.presentToast(\"Mot de passe ou e-mail incorrect\", \"danger\", this.toastController);\n         // On laisse de nouveau l'utilisateur agir une fois la réponse reçue\n        body.style.cursor = \"initial\"\n        elements.forEach(element => {\n          element.disabled = false;\n        });\n      });\n  }\n}\n","export default \".contenu {\\n  width: 100%;\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n}\\n\\nh1 {\\n  color: white;\\n  text-align: center;\\n  margin: auto;\\n}\\n\\nion-button {\\n  margin: auto;\\n  margin-top: 15px;\\n  display: block;\\n  width: 130px;\\n  height: 55px;\\n  font-size: 15px;\\n  text-transform: none;\\n}\\n\\nion-input {\\n  background-color: white;\\n  --padding-start:16px;\\n}\\n\\n@media (max-width: 576px) {\\n  h1 {\\n    font-size: 30px;\\n    margin-top: 10px;\\n  }\\n\\n  form {\\n    width: 90%;\\n    margin: auto;\\n  }\\n\\n  ion-input {\\n    border-radius: 10px;\\n    margin-bottom: 10px;\\n  }\\n}\\n\\n@media (min-width: 576px) {\\n  h1 {\\n    font-size: 60px;\\n    margin-top: 30px;\\n    margin-bottom: 30px;\\n  }\\n\\n  form {\\n    max-width: 800px;\\n    margin: auto;\\n  }\\n\\n  ion-input {\\n    margin-bottom: 40px;\\n  }\\n\\n  #buttons {\\n    display: flex;\\n    flex-direction: row;\\n    justify-content: space-around;\\n    max-width: 50%;\\n    margin: auto;\\n  }\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2F1dGhlbnRpZmljYXRpb24ucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUlBO0VBQ0UsV0FBQTtFQUNBLGtCQUFBO0VBQ0EsUUFBQTtFQUNBLFNBQUE7RUFDQSxnQ0FBQTtBQUhGOztBQU1BO0VBQ0ksWUFBQTtFQUNBLGtCQUFBO0VBQ0EsWUFBQTtBQUhKOztBQU1BO0VBQ0UsWUFBQTtFQUNBLGdCQUFBO0VBQ0EsY0FBQTtFQUNBLFlBQUE7RUFDQSxZQUFBO0VBQ0EsZUFBQTtFQUNBLG9CQUFBO0FBSEY7O0FBTUE7RUFDRSx1QkFBQTtFQUNBLG9CQUFBO0FBSEY7O0FBUUE7RUFDRTtJQUNFLGVBQUE7SUFDQSxnQkFBQTtFQUxGOztFQVFBO0lBQ0UsVUFBQTtJQUNBLFlBQUE7RUFMRjs7RUFRQTtJQUNFLG1CQUFBO0lBQ0EsbUJBQUE7RUFMRjtBQUNGOztBQVNBO0VBQ0U7SUFDRSxlQUFBO0lBQ0EsZ0JBQUE7SUFDQSxtQkFBQTtFQVBGOztFQVVBO0lBQ0UsZ0JBQUE7SUFDQSxZQUFBO0VBUEY7O0VBVUE7SUFDRSxtQkFBQTtFQVBGOztFQVVBO0lBQ0UsYUFBQTtJQUNBLG1CQUFBO0lBQ0EsNkJBQUE7SUFDQSxjQUFBO0lBQ0EsWUFBQTtFQVBGO0FBQ0YiLCJmaWxlIjoiYXV0aGVudGlmaWNhdGlvbi5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpb24tY29udGVudCB7XG4vLyAgICAgLS1iYWNrZ3JvdW5kOiB1cmwoXCIuLi8uLi9hc3NldHMvaW1hZ2VzL3dhbGxwYXBlcl90ZXJuZS5qcGdcIikgbm8tcmVwZWF0IGNlbnRlciBjZW50ZXIgLyBjb3Zlcjtcbi8vIH1cblxuLmNvbnRlbnUge1xuICB3aWR0aDoxMDAlO1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIHRvcDogNTAlO1xuICBsZWZ0OiA1MCU7XG4gIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpO1xufVxuXG5oMXtcbiAgICBjb2xvcjp3aGl0ZTtcbiAgICB0ZXh0LWFsaWduOmNlbnRlcjtcbiAgICBtYXJnaW46YXV0bztcbn1cblxuaW9uLWJ1dHRvbntcbiAgbWFyZ2luOmF1dG87XG4gIG1hcmdpbi10b3A6MTVweDtcbiAgZGlzcGxheTpibG9jaztcbiAgd2lkdGg6MTMwcHg7XG4gIGhlaWdodDo1NXB4O1xuICBmb250LXNpemU6MTVweDtcbiAgdGV4dC10cmFuc2Zvcm06IG5vbmU7XG59XG5cbmlvbi1pbnB1dCB7XG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICAtLXBhZGRpbmctc3RhcnQ6MTZweDtcbiAgXG59XG5cblxuQG1lZGlhIChtYXgtd2lkdGg6NTc2cHgpe1xuICBoMSB7XG4gICAgZm9udC1zaXplOjMwcHg7XG4gICAgbWFyZ2luLXRvcDoxMHB4O1xuICB9XG5cbiAgZm9ybSB7XG4gICAgd2lkdGg6OTAlO1xuICAgIG1hcmdpbjphdXRvO1xuICB9XG5cbiAgaW9uLWlucHV0IHtcbiAgICBib3JkZXItcmFkaXVzOjEwcHg7XG4gICAgbWFyZ2luLWJvdHRvbToxMHB4O1xuICB9XG59XG5cblxuQG1lZGlhIChtaW4td2lkdGg6NTc2cHgpe1xuICBoMSB7XG4gICAgZm9udC1zaXplOjYwcHg7XG4gICAgbWFyZ2luLXRvcDozMHB4O1xuICAgIG1hcmdpbi1ib3R0b206MzBweDtcbiAgfVxuXG4gIGZvcm0ge1xuICAgIG1heC13aWR0aDo4MDBweDtcbiAgICBtYXJnaW46YXV0bztcbiAgfVxuXG4gIGlvbi1pbnB1dCB7XG4gICAgbWFyZ2luLWJvdHRvbTo0MHB4O1xuICB9XG5cbiAgI2J1dHRvbnMge1xuICAgIGRpc3BsYXk6ZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjpyb3c7XG4gICAganVzdGlmeS1jb250ZW50OnNwYWNlLWFyb3VuZDtcbiAgICBtYXgtd2lkdGg6NTAlO1xuICAgIG1hcmdpbjphdXRvO1xuICB9XG59XG5cblxuXG5cblxuXG4iXX0= */\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { AuthentificationPage } from './authentification.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AuthentificationPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AuthentificationPageRoutingModule {}\n","export default \"<app-header></app-header>\\n\\n<ion-content>\\n    <!-- Voici le contenu normal de la page, qui s'affiche si l'utilisateur n'est pas connecté -->\\n    <div *ngIf=\\\"!isConnected\\\" class=\\\"contenu\\\">\\n        <h1>\\n            Se connecter\\n        </h1>\\n        <form [formGroup]=\\\"userForm\\\" (ngSubmit)=\\\"authentification()\\\">\\n            <ion-label class=\\\"ion-margin-bottom\\\" color=\\\"light\\\">\\n                Email\\n            </ion-label>\\n            <ion-input (keyup)=\\\"authentificationKey($event)\\\" type=\\\"email\\\" formControlName=\\\"email\\\"></ion-input>\\n            <ion-label class=\\\"ion-margin-bottom\\\" color=\\\"light\\\">\\n                Mot de passe\\n            </ion-label>\\n            <ion-input (keyup)=\\\"authentificationKey($event)\\\" type=\\\"password\\\" formControlName=\\\"password\\\"></ion-input>\\n            <div id=\\\"buttons\\\">\\n                <ion-button [disabled]=\\\"!this.isValid\\\" type=\\\"submit\\\" size=\\\"large\\\">Valider</ion-button>\\n                <ion-button size=\\\"large\\\" [routerLink]=\\\"['/reinitialisation-mdp']\\\" class=\\\"ion-text-wrap\\\">Mot de passe oublié</ion-button>\\n            </div>\\n        </form>\\n    </div>\\n    <!-- S'il est connecté, on ne donne pas accès à cette page (et donc à la requête) -->\\n    <div *ngIf=\\\"isConnected\\\" class=\\\"contenu\\\">\\n        <h1>Vous êtes déjà connectés</h1>\\n    </div>\\n\\n</ion-content>\";","import { InjectionToken, Injectable, Inject, NgModule, Optional, SkipSelf } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { mergeMap } from 'rxjs/operators';\nimport { from } from 'rxjs';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport * as ɵngcc0 from '@angular/core';\nconst JWT_OPTIONS = new InjectionToken('JWT_OPTIONS');\n\n// tslint:disable:no-bitwise\nclass JwtHelperService {\n    constructor(config = null) {\n        this.tokenGetter = (config && config.tokenGetter) || function () { };\n    }\n    urlBase64Decode(str) {\n        let output = str.replace(/-/g, \"+\").replace(/_/g, \"/\");\n        switch (output.length % 4) {\n            case 0: {\n                break;\n            }\n            case 2: {\n                output += \"==\";\n                break;\n            }\n            case 3: {\n                output += \"=\";\n                break;\n            }\n            default: {\n                throw new Error(\"Illegal base64url string!\");\n            }\n        }\n        return this.b64DecodeUnicode(output);\n    }\n    // credits for decoder goes to https://github.com/atk\n    b64decode(str) {\n        const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n        let output = \"\";\n        str = String(str).replace(/=+$/, \"\");\n        if (str.length % 4 === 1) {\n            throw new Error(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n        }\n        for (\n        // initialize result and counters\n        let bc = 0, bs, buffer, idx = 0; \n        // get next character\n        (buffer = str.charAt(idx++)); \n        // character found in table? initialize bit storage and add its ascii value;\n        ~buffer &&\n            ((bs = bc % 4 ? bs * 64 + buffer : buffer),\n                // and if not first of each 4 characters,\n                // convert the first 8 bits to one ascii character\n                bc++ % 4)\n            ? (output += String.fromCharCode(255 & (bs >> ((-2 * bc) & 6))))\n            : 0) {\n            // try to find character in table (0-63, not found => -1)\n            buffer = chars.indexOf(buffer);\n        }\n        return output;\n    }\n    b64DecodeUnicode(str) {\n        return decodeURIComponent(Array.prototype.map\n            .call(this.b64decode(str), (c) => {\n            return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n            .join(\"\"));\n    }\n    decodeToken(token = this.tokenGetter()) {\n        if (!token || token === \"\") {\n            return null;\n        }\n        const parts = token.split(\".\");\n        if (parts.length !== 3) {\n            throw new Error(\"The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.\");\n        }\n        const decoded = this.urlBase64Decode(parts[1]);\n        if (!decoded) {\n            throw new Error(\"Cannot decode the token.\");\n        }\n        return JSON.parse(decoded);\n    }\n    getTokenExpirationDate(token = this.tokenGetter()) {\n        let decoded;\n        decoded = this.decodeToken(token);\n        if (!decoded || !decoded.hasOwnProperty(\"exp\")) {\n            return null;\n        }\n        const date = new Date(0);\n        date.setUTCSeconds(decoded.exp);\n        return date;\n    }\n    isTokenExpired(token = this.tokenGetter(), offsetSeconds) {\n        if (!token || token === \"\") {\n            return true;\n        }\n        const date = this.getTokenExpirationDate(token);\n        offsetSeconds = offsetSeconds || 0;\n        if (date === null) {\n            return false;\n        }\n        return !(date.valueOf() > new Date().valueOf() + offsetSeconds * 1000);\n    }\n    getAuthScheme(authScheme, request) {\n        if (typeof authScheme === \"function\") {\n            return authScheme(request);\n        }\n        return authScheme;\n    }\n}\nJwtHelperService.ɵfac = function JwtHelperService_Factory(t) { return new (t || JwtHelperService)(ɵngcc0.ɵɵinject(JWT_OPTIONS)); };\nJwtHelperService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: JwtHelperService, factory: JwtHelperService.ɵfac });\nJwtHelperService.ctorParameters = () => [\n    { type: undefined, decorators: [{ type: Inject, args: [JWT_OPTIONS,] }] }\n];\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(JwtHelperService, [{\n        type: Injectable\n    }], function () { return [{ type: undefined, decorators: [{\n                type: Inject,\n                args: [JWT_OPTIONS]\n            }] }]; }, null); })();\n\nclass JwtInterceptor {\n    constructor(config, jwtHelper, document) {\n        this.jwtHelper = jwtHelper;\n        this.document = document;\n        this.standardPorts = [\"80\", \"443\"];\n        this.tokenGetter = config.tokenGetter;\n        this.headerName = config.headerName || \"Authorization\";\n        this.authScheme =\n            config.authScheme || config.authScheme === \"\"\n                ? config.authScheme\n                : \"Bearer \";\n        this.allowedDomains = config.allowedDomains || [];\n        this.disallowedRoutes = config.disallowedRoutes || [];\n        this.throwNoTokenError = config.throwNoTokenError || false;\n        this.skipWhenExpired = config.skipWhenExpired;\n    }\n    isAllowedDomain(request) {\n        const requestUrl = new URL(request.url, this.document.location.origin);\n        // If the host equals the current window origin,\n        // the domain is allowed by default\n        if (requestUrl.host === this.document.location.host) {\n            return true;\n        }\n        // If not the current domain, check the allowed list\n        const hostName = `${requestUrl.hostname}${requestUrl.port && !this.standardPorts.includes(requestUrl.port)\n            ? \":\" + requestUrl.port\n            : \"\"}`;\n        return (this.allowedDomains.findIndex((domain) => typeof domain === \"string\"\n            ? domain === hostName\n            : domain instanceof RegExp\n                ? domain.test(hostName)\n                : false) > -1);\n    }\n    isDisallowedRoute(request) {\n        const requestedUrl = new URL(request.url, this.document.location.origin);\n        return (this.disallowedRoutes.findIndex((route) => {\n            if (typeof route === \"string\") {\n                const parsedRoute = new URL(route, this.document.location.origin);\n                return (parsedRoute.hostname === requestedUrl.hostname &&\n                    parsedRoute.pathname === requestedUrl.pathname);\n            }\n            if (route instanceof RegExp) {\n                return route.test(request.url);\n            }\n            return false;\n        }) > -1);\n    }\n    handleInterception(token, request, next) {\n        const authScheme = this.jwtHelper.getAuthScheme(this.authScheme, request);\n        let tokenIsExpired = false;\n        if (!token && this.throwNoTokenError) {\n            throw new Error(\"Could not get token from tokenGetter function.\");\n        }\n        if (this.skipWhenExpired) {\n            tokenIsExpired = token ? this.jwtHelper.isTokenExpired(token) : true;\n        }\n        if (token && tokenIsExpired && this.skipWhenExpired) {\n            request = request.clone();\n        }\n        else if (token) {\n            request = request.clone({\n                setHeaders: {\n                    [this.headerName]: `${authScheme}${token}`,\n                },\n            });\n        }\n        return next.handle(request);\n    }\n    intercept(request, next) {\n        if (!this.isAllowedDomain(request) || this.isDisallowedRoute(request)) {\n            return next.handle(request);\n        }\n        const token = this.tokenGetter(request);\n        if (token instanceof Promise) {\n            return from(token).pipe(mergeMap((asyncToken) => {\n                return this.handleInterception(asyncToken, request, next);\n            }));\n        }\n        else {\n            return this.handleInterception(token, request, next);\n        }\n    }\n}\nJwtInterceptor.ɵfac = function JwtInterceptor_Factory(t) { return new (t || JwtInterceptor)(ɵngcc0.ɵɵinject(JWT_OPTIONS), ɵngcc0.ɵɵinject(JwtHelperService), ɵngcc0.ɵɵinject(DOCUMENT)); };\nJwtInterceptor.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: JwtInterceptor, factory: JwtInterceptor.ɵfac });\nJwtInterceptor.ctorParameters = () => [\n    { type: undefined, decorators: [{ type: Inject, args: [JWT_OPTIONS,] }] },\n    { type: JwtHelperService },\n    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] }\n];\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(JwtInterceptor, [{\n        type: Injectable\n    }], function () { return [{ type: undefined, decorators: [{\n                type: Inject,\n                args: [JWT_OPTIONS]\n            }] }, { type: JwtHelperService }, { type: Document, decorators: [{\n                type: Inject,\n                args: [DOCUMENT]\n            }] }]; }, null); })();\n\nclass JwtModule {\n    constructor(parentModule) {\n        if (parentModule) {\n            throw new Error(\"JwtModule is already loaded. It should only be imported in your application's main module.\");\n        }\n    }\n    static forRoot(options) {\n        return {\n            ngModule: JwtModule,\n            providers: [\n                {\n                    provide: HTTP_INTERCEPTORS,\n                    useClass: JwtInterceptor,\n                    multi: true,\n                },\n                options.jwtOptionsProvider || {\n                    provide: JWT_OPTIONS,\n                    useValue: options.config,\n                },\n                JwtHelperService,\n            ],\n        };\n    }\n}\nJwtModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: JwtModule });\nJwtModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function JwtModule_Factory(t) { return new (t || JwtModule)(ɵngcc0.ɵɵinject(JwtModule, 12)); } });\nJwtModule.ctorParameters = () => [\n    { type: JwtModule, decorators: [{ type: Optional }, { type: SkipSelf }] }\n];\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(JwtModule, [{\n        type: NgModule\n    }], function () { return [{ type: JwtModule, decorators: [{\n                type: Optional\n            }, {\n                type: SkipSelf\n            }] }]; }, null); })();\n\n/*\n * Public API Surface of angular-jwt\n */\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { JWT_OPTIONS, JwtHelperService, JwtInterceptor, JwtModule };\n\n//# sourceMappingURL=auth0-angular-jwt.js.map"]}