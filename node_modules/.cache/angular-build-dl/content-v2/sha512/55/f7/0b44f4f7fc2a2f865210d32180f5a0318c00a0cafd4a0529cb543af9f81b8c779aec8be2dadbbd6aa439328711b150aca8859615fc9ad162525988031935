{"version":3,"sources":["webpack:///src/app/edit-user/edit-user-routing.module.ts","webpack:///src/app/edit-user/edit-user.module.ts","webpack:///src/app/shared-modules/shared-modules.module.ts","webpack:///src/app/edit-user/edit-user.page.ts","webpack:///src/app/edit-user/edit-user.page.scss","webpack:///src/app/edit-user/edit-user.page.html"],"names":["routes","path","component","EditUserPageRoutingModule","imports","forChild","exports","EditUserPageModule","declarations","SharedModulesModule","EditUserPage","formBuilder","service","toastController","route","navController","isValidateEnabled","isImageImported","user","JSON","parse","sessionStorage","getItem","token","userForm","group","email","verifyEmail","address","phone","valueChanges","subscribe","values","adress","event","image","target","files","sizeMB","size","getImage64","presentToast","file","reader","FileReader","readAsDataURL","onload","result","image64","String","onerror","error","updateUserImg","id","response","console","log","findImg","value","toLowerCase","updateUser","setItem","stringify","pop","selector","template"],"mappings":"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","file":"edit-user-edit-user-module-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { EditUserPage } from './edit-user.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: EditUserPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class EditUserPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { IonicModule } from '@ionic/angular';\nimport { EditUserPageRoutingModule } from './edit-user-routing.module';\nimport { EditUserPage } from './edit-user.page';\nimport { SharedModulesModule } from '../shared-modules/shared-modules.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    EditUserPageRoutingModule,\n    FormsModule,\n    ReactiveFormsModule,\n    SharedModulesModule\n  ],\n  declarations: [EditUserPage]\n})\nexport class EditUserPageModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HeaderComponent } from '../header/header.component';\nimport { RouterModule } from '@angular/router';\n\n\n@NgModule({\n  declarations: [HeaderComponent],\n  imports: [\n    CommonModule,\n    RouterModule\n  ],\n  exports:[HeaderComponent]\n})\nexport class SharedModulesModule { }\n","import { Component, OnInit, SimpleChanges } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { ActivatedRoute } from '@angular/router';\nimport { NavController, ToastController } from '@ionic/angular';\nimport { CantiniereAPIService } from '../cantiniere-api.service';\nimport { User } from '../model/User';\nimport { EmailUtils } from '../utils/EmailUtils';\nimport { ToastUtils } from '../utils/ToastUtils';\n\n@Component({\n  selector: 'app-edit-user',\n  templateUrl: './edit-user.page.html',\n  styleUrls: ['./edit-user.page.scss'],\n})\nexport class EditUserPage implements OnInit {\n\n  constructor(private formBuilder: FormBuilder, private service: CantiniereAPIService, private toastController: ToastController, private route: ActivatedRoute, private navController: NavController) {}\n\n  token: string\n  user\n  userForm: FormGroup\n  isValidateEnabled: boolean = false\n  isImageImported: boolean = false\n  image64: string\n\n  ngOnInit() {\n\n    // User et Token recupéré depuis la sessionStorage\n    // ils existent forcement car on ne peut acceder à cette page que si on est connecté\n    this.user = JSON.parse(sessionStorage.getItem(\"User\"))\n    this.token = sessionStorage.getItem(\"JWT\")\n\n    //let userId = this.route.snapshot.paramMap.get(\"id\")\n\n    this.userForm = this.formBuilder.group({\n      email: this.user.email,\n      verifyEmail: this.user.email,\n      address: this.user.address,\n      phone: this.user.phone\n    })\n\n    this.userForm.valueChanges.subscribe(values => {\n      \n      if(values.email != \"\" && values.verifyEmail != \"\" && values.adress != \"\" && values.phone != null){\n        this.isValidateEnabled = true\n      } else this.isValidateEnabled = false\n\n    })\n  }\n\n  // executée quand l'image est importée par l'utilisateur\n  onImageUploaded(event: any) {\n    const image = event.target.files[0]\n\n    let sizeMB = image.size / 1000000\n\n    if(sizeMB < 5){\n\n      this.getImage64(image)\n      this.isImageImported = true\n\n    } else ToastUtils.presentToast(\"Veuillez importer une image inférieure à 5MB\", \"danger\", this.toastController)\n\n  }\n\n  getImage64(file :any){\n    let reader = new FileReader()\n\n    reader.readAsDataURL(file)\n\n    reader.onload = (result) => {\n        this.image64 = String(result.target.result)\n    }\n\n    reader.onerror = (error) => {\n        ToastUtils.presentToast(\"Une erreur s'est produite lors de l'import de l'image\", \"danger\", this.toastController)\n    }\n  }\n\n  // executée quand l'utilisateur clique sur modifier avatar\n  uploadImage(){\n    \n    // desactivation du bouton au click \n    this.isImageImported = false\n\n    this.service.updateUserImg(this.user.id, this.image64, this.token).subscribe((response) => {\n      \n      console.log(response)\n\n      this.service.findImg(this.user.id, this.token).subscribe((response) => {\n        console.log(response)\n        //this.user.image.imagePath = response.body.imagePath\n      })\n\n      //this.navController.pop()\n    }, (error) => {\n      console.log(error)\n      ToastUtils.presentToast(\"Une erreur s'est produire lors de la modification de l'avatar\", \"danger\", this.toastController)\n    })\n\n  }\n\n  onValidate(){\n    let values = this.userForm.value\n\n    if(values.email.toLowerCase() == values.verifyEmail.toLowerCase()){\n      if(EmailUtils.verifyEmail(values.email)){\n        \n        this.user.email = values.email.toLowerCase()\n        this.user.address = values.address\n        this.user.phone = values.phone\n        // this.user.password = null\n        this.service.updateUser(this.user, this.token).subscribe((response) => {\n          console.log(response)\n          ToastUtils.presentToast(\"Informations modifées avec succès\", \"success\", this.toastController)\n\n          // mise à jour de l'utilisateur en sessionStorage\n          sessionStorage.setItem(\"User\", JSON.stringify(this.user))\n          \n          // retour en arrière\n          this.navController.pop()\n          \n        }, (error) => {\n          console.log(error)\n          ToastUtils.presentToast(\"Une erreur s'est produite\", \"danger\", this.toastController)\n        })\n\n      } else {\n        ToastUtils.presentToast(\"Veuillez saisir un email valide\", \"danger\", this.toastController)\n      }\n    } else {\n      ToastUtils.presentToast(\"Les emails ne sont pas identiques\", \"danger\", this.toastController)\n    }\n  }\n}","export default \"h1 {\\n  color: white;\\n  text-align: center;\\n}\\n\\nion-label {\\n  font-size: large;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2VkaXQtdXNlci5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUE7RUFDSSxZQUFBO0VBQ0Esa0JBQUE7QUFISjs7QUFNQTtFQUNJLGdCQUFBO0FBSEoiLCJmaWxlIjoiZWRpdC11c2VyLnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGlvbi1jb250ZW50e1xuLy8gICAgIC0tYmFja2dyb3VuZDogdXJsKFwiLi4vLi4vYXNzZXRzL2ltYWdlcy93YWxscGFwZXJcXCBjYWZldGVyaWEuanBnXCIpIG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyIC8gY292ZXI7XG4vLyB9XG5cbmgxe1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59XG5cbmlvbi1sYWJlbHtcbiAgICBmb250LXNpemU6IGxhcmdlO1xufSJdfQ== */\";","export default \"<ion-header>\\n  <app-header></app-header>\\n</ion-header>\\n\\n<ion-content>\\n\\n  <h1>Modifier les infos du compte</h1>\\n\\n  <form [formGroup]=\\\"userForm\\\" (ngSubmit)=\\\"onValidate()\\\" class=\\\"ion-margin-horizontal\\\" *ngIf=\\\"user\\\">\\n\\n    <ion-input type=\\\"file\\\" (change)=\\\"onImageUploaded($event)\\\" accept=\\\".png, .jpg, .jpeg\\\"></ion-input>\\n    <div class=\\\"ion-text-center\\\">\\n      <ion-button (click)=\\\"uploadImage()\\\" [disabled]=\\\"!this.isImageImported\\\" class=\\\"ion-margin-bottom\\\" color=\\\"primary\\\">Modifier avatar</ion-button>\\n    </div>\\n\\n    <ion-label class=\\\"ion-margin-bottom\\\" color=\\\"light\\\">Nom</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input color=\\\"medium\\\" type=\\\"text\\\" name=\\\"name\\\" readonly>{{user.name}}</ion-input>\\n    </ion-item>\\n\\n    <ion-label color=\\\"light\\\">Prénom</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input color=\\\"medium\\\" type=\\\"text\\\" name=\\\"firstname\\\" readonly>{{user.firstname}}</ion-input>\\n    </ion-item>\\n\\n    <ion-label color=\\\"light\\\">Email</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input type=\\\"email\\\" autocomplete=\\\"email\\\" formControlName=\\\"email\\\"></ion-input>\\n    </ion-item>\\n\\n    <ion-label color=\\\"light\\\">Vérifier email</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input type=\\\"email\\\" autocomplete=\\\"off\\\" formControlName=\\\"verifyEmail\\\"></ion-input>\\n    </ion-item>\\n\\n    <ion-label color=\\\"light\\\">Adresse</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input type=\\\"text\\\" formControlName=\\\"address\\\"></ion-input>\\n    </ion-item>\\n\\n    <ion-label color=\\\"light\\\">Tél.</ion-label>\\n    <ion-item class=\\\"ion-margin-bottom\\\">\\n      <ion-input type=\\\"phone\\\" formControlName=\\\"phone\\\"></ion-input>\\n    </ion-item>\\n    \\n    <div class=\\\"ion-text-center\\\">\\n      <ion-button [disabled]=\\\"!this.isValidateEnabled\\\" type=\\\"submit\\\" class=\\\"ion-margin-bottom\\\" color=\\\"primary\\\">Valider</ion-button>\\n    </div>\\n  </form>\\n\\n</ion-content>\";"]}